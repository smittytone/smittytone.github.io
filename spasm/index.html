<!doctype html>
<html lang="en">
<head>
    <meta name="Description" content="Tony Smith's software library: Spasm, a simple assembler/disassembler for the Motorola 6809 8-bit microprocessor" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Abel" rel="stylesheet" />
    <link href="../images/favicons/196.png" rel="shortcut icon" />
    <link href="../images/favicons/apple-touch-icon.png" rel="apple-touch-icon" />
    <link href="../css/squinter.css" rel="stylesheet" type="text/css" />
    <title>Spasm</title>
</head>

<body>
    <div class="container-fluid" id="ctop">
        
<nav class="navbar navbar-expand-lg navbar-custom">
    <div class="navbar-header">
        <a class="navbar-brand" href="../index.html">
            <img src="../images/spasm/spw.png" style="width:32px;height:32px;" class="navimgb align-top" />
            <img src="../images/spasm/spw.png" style="width:32px;height:32px;" class="navimgw align-top" />
            &nbsp;Spasm
        </a>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <ul class="nav navbar-nav mr-auto">
            
            <li class="nav-item"><a class="nav-link" href="#about-spasm-">About Spasm</a></li>
            
            <li class="nav-item"><a class="nav-link" href="#release-notes-">Release Notes</a></li>
            
            <li class="nav-item"><a class="nav-link" href="#source-code-">Source Code</a></li>
            
        </ul>
        <ul class="nav navbar-nav navbar-right">
            <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
        </ul>
    </div>
</nav>
        <div class="frame">
            <div class="row">
                <div class="col-1 col-lg-2">&nbsp;</div>
                <div class="col-10 col-lg-8">
                    <h2 class="text-center">Spasm</h2>
                    <h3 class="text-center">A simple assembler/disassembler for the Motorola 6809 8-bit microprocessor</h3>
                    
<h4 class="text-center">Latest Release: <a class="link" href="#release-notes-">1.2.0</a></h4>

<p>&nbsp;</p>
                    
                    <h3 id="about-spasm-">About Spasm</h3>
<p><em>spasm</em> is an assembler/disassembler for the <a href="https://en.wikipedia.org/wiki/Motorola_6809" class="link">Motorola 6809 microprocessor</a> written in Python 3.</p>
<p>It was written to generate 6809 machine code for a separate processor emulation project. As such, it does not output files into a standard format, but in the form of JSON intended to be read by the emulator. The output file’s extension is <code>.6809</code>, but it is a text file containing a JSON object:</p>
<pre><code>{ &quot;address&quot; : &lt;start_address_of_code&gt;,
  &quot;code&quot;    : &lt;string_of_assembled_code_bytes&gt; }
</code></pre><p>A sample file, <code>sample01.6809</code>, is included with the repository.</p>
<p>Input is in the form of one or more <code>.asm</code> files which are text files containing the source code. For example:</p>
<pre><code>; All comments go after a semi-colon

@tab_len    EQU %11111111       ; Table length in binary
@object     EQU $EE01           ; Object address in hex
@entlen     EQU $08             ; Table entry length
@search     LDB #@tab_len
            BEQ @exit           ; Exit if the table length is zero
            LDY #@object
            LDX #@store
@loop       PSHS B              ; start loop
            LDA #$2
@nextch     LDB A,Y
            CMPA B,X
            LEAX 3,X
            CMPA $2A,Y
            BNE @nexten         ; break out of loop
            DECB
            BPL @nextch
            PULS B
            LDA #$FF
            RTS
@nexten     PULS B
            DECB
            BEQ @exit
            LEAX @entlen,X       ; Interesting problem: this could add 0, 1 or 2
                                 ; bytes depending on the value of @entlen, which
                                 ; might not have been specified on the first pass
@exit       CLRA
@store      RMB @entlen
            RTS                  ; return
</code></pre><h3 id="assembler-conventions-">Assembler Conventions</h3>
<h4 id="literals-">Literals</h4>
<p>Various literal types are supported. Literals are assumed to be decimal, but you can change this by using the following prefixes:</p>
<ul>
<li><code>%</code> — a binary value, eg. <code>%10001111</code> (equals <code>0x8F</code>, 143).</li>
<li><code>'</code> — an 8-bit Ascii value, eg. <code>'A</code> (equals <code>0x41</code>, 65).</li>
<li><code>$</code> — a hexadecimal value, eg, <code>$FF00</code> (equals 65280).<br /><strong>Note</strong> <em>spasm</em> can also read hexadecimal values prefixed with <code>0x</code> for modern users, but <code>$</code> is the classic Motorola prefix.</li>
</ul>
<h4 id="labels-">Labels</h4>
<p>As the above example shows, <em>spasm</em> supports the use of labels to represent values and memory locations (eg. for jumps and branches). All labels <strong>must</strong> be prefixed with <code>@</code>.</p>
<h4 id="comments-">Comments</h4>
<p>Comments can be entered by prefixing them with a <code>;</code> or <code>*</code> (for DREAM fans). At this time, multi-line comment indicators have not yet been implemented.</p>
<h4 id="directives-">Directives</h4>
<p><em>spasm</em>  makes use of the following assembler directives (aka pseudo-ops):</p>
<ul>
<li><code>EQU</code> — assign a value to a label, eg. <code>@label EQU 255</code>.</li>
<li><code>END</code> — optional end-of-code marker.</li>
<li><code>RMB</code> — reserve <em>n</em> memory bytes at this address, eg. <code>@label RMB 8 ; add 8 bytes for data storage</code>.</li>
<li><code>FCB</code> — store the following 8-bit value or values at this address, eg.
<ul>
<li><code>@label FCB $FF          ; poke 255 to this address</code>.</li>
<li><code>@label FCB $FF,$01,$02  ; poke 255, 0, 2 to sequential addresses from this</code>.</li>
</ul>
</li>
<li><code>FCC</code> — store the following string at this address, eg.
<ul>
<li><code>@label FCC &quot;Message&quot;    ; poke 77,101,115,115,97,103,101 to sequential addresses</code>.</li>
</ul>
</li>
<li><code>FDB</code> — store the following 16-bit value or values at this address, eg.
<ul>
<li><code>@label FDB $FF00        ; poke 65280 to this address</code>.</li>
<li><code>@label FDB $FF00,$FF01  ; poke 65280, 65281 to sequential addresses</code>.</li>
<li><strong>Note</strong> The 6809 expects the most-significant byte at the lowest address.</li>
</ul>
</li>
<li><code>ORG</code> — continue assembly at the supplied address, eg. <code>@label ORG $3FFF ; continue assembly at address 16383</code>.</li>
</ul>
<h4 id="endianism-">Endianism</h4>
<p>Motorola microprocessors are big endian, ie. the most-significant byte is written at the lowest  memory address and the least-significant byte is written at the highest address.</p>
<p>For example: store the 16-bit value <code>0x1A2B</code> from the address <code>0xFF00</code>:</p>
<pre><code>0xFF00    0x1A
0xFF01    0x2B
</code></pre><h3 id="sample-code-">Sample Code</h3>
<p>There are sample 6809 assembler programs and assembled <code>.6809</code> files in the <a href="/samples">samples</a> folder.</p>
<h3 id="disassembly-">Disassembly</h3>
<p><em>spasm</em> will disassemble <code>.6809</code> files, using the start address included in the file. It can also disassemble <code>.rom</code> files. Since these do not include address information, you can use the <code>-s</code> switch to set the effective address of the first byte in the <code>.rom</code> file. Because you may not wish to disassemble the entire file, you can use the <code>-b</code> switch to set the address from which disassembly will begin, and <code>-n</code> to set the number of bytes you want to disassemble.</p>
<p>For example, if you have a 16KB ROM that is expected to be placed at <code>0x8000</code> in the 6809 memory map, you set the start address (with <code>-s</code>) to <code>0x8000</code>. However, you only want to disassemble from <code>0x9000</code>, so you use <code>-b</code> to set the base address to <code>0x9000</code>. You only want to disassemble the 128 bytes at <code>0x9000</code>, so you use <code>-n 128</code>:</p>
<pre><code>./spasm.py my_rom.rom -s 0x8000 -b 0x9000 -n 128
</code></pre><p>This might output:</p>
<pre><code>Address   Operation       Bytes
-------------------------------
0x9000    BNE    $9008    2606
0x9002    CMPB   #84      C184
0x9004    BNE    $900C    2606
0x9006    LDA    #3A      863A
0x9008    STD    ,U++     EDC1
0x900A    BRA    $8FA1    2094
0x900C    STB    ,U+      E7C0
0x900E    CMPB   #86      C186
0x9010    BNE    $9014    2602
0x9012    INC    &gt;44      0C44
0x9014    CMPB   #82      C182
0x9016    BEQ    $8FC3    27AA
0x9018    BRA    $8FA1    2086
0x901A    LDU    #011B    CE011B
0x901D    COM    &gt;41      0341
0x901F    BNE    $8FE2    26C0
0x9021    PULS   X,U      3550
0x9023    LDA    ,X+      A680
0x9025    STA    ,U+      A7C0
0x9027    JSR    8ADF     BD8ADF
0x902A    BLO    $9019    25EC
0x902C    COM    &gt;43      0343
0x902E    BRA    $9019    20E8
0x9030    INC    &gt;42      0C42
0x9032    DECA            4A
0x9033    BEQ    $8FE4    27AE
0x9035    LEAY   $0F,Y    313F
0x9037    LDB    ,Y+      E6A0
0x9039    BPL    $9038    2AFC
0x903B    BRA    $8FED    20AF
0x903D    BEQ    $90A1    2762
0x903F    BSR    $9044    8D03
0x9041    CLR    &gt;6F      0F6F
0x9043    RTS             39
0x9044    CMPA   #40      8140
0x9046    BNE    $904D    2605
0x9048    JSR    B786     BDB786
0x904B    BRA    $9057    200A
0x904D    CMPA   #23      8123
0x904F    BNE    $905E    260D
0x9051    JSR    B7D7     BDB7D7
0x9054    JSR    B63C     BDB63C
0x9057    JSR    &gt;A5      9DA5
0x9059    BEQ    $90A1    2746
0x905B    JSR    89AA     BD89AA
0x905E    CMPA   #CD      81CD
0x9060    LBEQ   $A224    102711C1
0x9063    BEQ    $90AD    2748
0x9065    CMPA   #BB      81BB
0x9067    BEQ    $90C6    275D
0x9069    CMPA   #2C      812C
0x906B    BEQ    $90AE    2741
0x906D    CMPA   #3B      813B
0x906F    BEQ    $90DF    276E
0x9071    JSR    8887     BD8887
0x9074    LDA    &gt;06      9606
0x9076    PSHS   A        3402
0x9078    BNE    $9080    2606
0x907A    JSR    9587     BD9587
0x907D    JSR    8C59     BD8C59
</code></pre><p>The <code>-b</code> and <code>-n</code> switches can be used when you are disassembling <code>.6809</code> files, but the code’s start address will always be taken from the file, not an address set with <code>-s</code>.</p>
<p>See below for a full list of <em>spasm</em> switches.</p>
<h3 id="command-line-">Command Line</h3>
<p><em>spasm</em> is a command line tool. It supports the following switches:</p>
<table>
<thead>
<tr>
<th align="center">Option</th>
<th align="center">Alternative</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>-h</code></td>
<td align="center"><code>--help</code></td>
<td>Print help information</td>
</tr>
<tr>
<td align="center"><code>-v</code></td>
<td align="center"><code>--version</code></td>
<td>Display <em>spasm</em> version information</td>
</tr>
<tr>
<td align="center"><code>-q</code></td>
<td align="center"><code>--quiet</code></td>
<td>Display no extra information during assembly. This overrides verbose mode,<br />which is the default</td>
</tr>
<tr>
<td align="center"><code>-s</code></td>
<td align="center"><code>--start</code></td>
<td>Set the start address of the assembled code, specified as a hex or decimal value.<br /><strong>Note</strong> You can use $ as a prefix for a hex value, but you will need to place<br />the address in single quotes, eg. <code>spasm.py zzz.asm -s '$FF00'</code> to avoid confusing Bash</td>
</tr>
<tr>
<td align="center"><code>-b</code></td>
<td align="center"><code>--baseaddress</code></td>
<td>Set the base address for disassembled code, specified as a hex or decimal value.<br />Ignored during assembly</td>
</tr>
<tr>
<td align="center"><code>-n</code></td>
<td align="center"><code>--numbytes</code></td>
<td>Set the number of bytes to disassemble, specified as a hex or decimal value.<br />Ignored during assembly</td>
</tr>
<tr>
<td align="center"><code>-o</code></td>
<td align="center"><code>--output</code></td>
<td>Cause the 6809 output file to be written and, optionally, name it. If you pass no name,<br />the output file name will match that of the input file but with a <code>.6809</code> extension</td>
</tr>
<tr>
<td align="center"><code>-l</code></td>
<td align="center"><code>--lower</code></td>
<td>Display opcodes in lowercase</td>
</tr>
<tr>
<td align="center"><code>-u</code></td>
<td align="center"><code>--upper</code></td>
<td>Display opcodes in uppercase.<br /><strong>Note</strong> This and the above switch will overwrite each other; if both are called:<br />the last one wins. If neither is used, the output matches the input</td>
</tr>
</tbody>
</table>
<p class="linktext" align="right"><a class="link" href="#ctop">Back to the Top</a></p>
<hr />
<h3 id="release-notes-">Release Notes</h3>
<ul>
<li>1.2.0 <em>29 May 2019</em>
<ul>
<li><em>Improvements</em>
<ul>
<li>Fully support <code>ORG</code> directive: assemble code into multiple chunks.</li>
<li>Add support for <code>FCC</code> directive: assemble code Ascii strings to bytes.</li>
<li>Improve operation of <code>FCB</code> and <code>FDB</code> directives.</li>
<li><code>.6809</code> files&rsquo; <em>code</em> field now contains a string of two-character hex values.</li>
<li>Change <code>-v</code> switch to present version info (as verbose mode is default).</li>
</ul>
</li>
<li><em>Bug Fixes</em>
<ul>
<li>Handle negative operands correctly.</li>
<li>Handle indirect extended addressing correctly.</li>
<li>Check ops that expect an 8-bit value don't get a 16-bit value.</li>
<li>Correct address increments during disassembly of extended opcodes.</li>
</ul>
</li>
</ul>
</li>
<li>1.1.0 <em>30 April 2019</em>
<ul>
<li><em>Improvements</em>
<ul>
<li>Add disassembly of <code>.rom</code> files.</li>
<li>Add <code>-n</code> switch to set number of bytes of code to be disassembled.</li>
<li>Add <code>-b</code> switch to set base address of disassembly.</li>
</ul>
</li>
</ul>
</li>
<li>1.0.0 <em>12 April 2019</em>
<ul>
<li>Initial public release.</li>
</ul>
</li>
</ul>
<p class="linktext" align="right"><a class="link" href="#ctop">Back to the Top</a></p>
<hr />
<h3 id="source-code-">Source Code</h3>
<p>You can view Spasm’s source code <a class="link" href="https://github.com/smittytone/spasm">at GitHub</a>.</p>
<p class="linktext" align="right"><a class="link" href="#ctop">Back to the Top</a></p>
<hr />

                    

<h3>Related Software</h3>
<ul>
	
	<li><a class="link" href="/hex/">Hex</a></li>
	
	<li><a class="link" href="/ski/">Ski</a></li>
	
	<li><a class="link" href="/unicoder/">Unicoder</a></li>
	
	<li><a class="link" href="/xbeeparser/">XBeeParser</a></li>
	
</ul>

<p class="linktext" align="right"><a class="link" href="#ctop">Back to the Top</a></p>
<hr />
                </div>
                <div class="col-1 col-lg-2">&nbsp;</div>
            </div>
            <div class="col">
    <p class="text-center"><a class="colo" href="https://smittytone.github.io"><img class="imgw" src="../images/rassilon.png" style="width:32px;height:32px;" alt="The Seal of Rassilon" /><img class="imgb" src="../images/rassilonblack.png" style="width:32px;height:32px;" alt="The Seal of Rassilon" /></a><br /><small>Site and software copyright &copy; 2014-20, Tony Smith<br />Site Last Updated: 20 January 2020</small></p>
</div>
            
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script type="text/javascript" src="../scripts/retina.min.js"></script>
<script>
    $('a[href*="#"]').not('[href="#"]').not('[href="#0"]').click(function(event) {
        if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
            event.preventDefault();
            var hash = this.hash;
            $('html, body').animate({scrollTop: $(hash).offset().top}, 800, function(){window.location.hash = hash;});
        }
    });
</script>
</body>
</html>